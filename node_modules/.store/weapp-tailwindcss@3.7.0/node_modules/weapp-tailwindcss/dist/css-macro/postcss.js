'use strict';

var constants = require('../constants-CFM1J-h1.js');

const creator = () => {
    return {
        postcssPlugin: 'postcss-weapp-tw-css-macro-plugin',
        prepare() {
            return {
                AtRule(atRule, helper) {
                    var _a;
                    if (atRule.name === 'media') {
                        const values = [];
                        constants.matchCustomPropertyFromValue(atRule.params, (arr) => {
                            values.push(arr[1]);
                        });
                        if (values.length > 0) {
                            const isNegative = atRule.params.includes('not');
                            const text = values.join(' ');
                            const comment = isNegative ? constants.ifndef(text) : constants.ifdef(text);
                            atRule.replaceWith([
                                helper.comment({
                                    raws: {
                                        before: '\n',
                                    },
                                    text: comment.start,
                                }),
                                ...((_a = atRule.nodes) !== null && _a !== void 0 ? _a : []),
                                helper.comment({
                                    raws: {
                                        before: '\n',
                                    },
                                    text: comment.end,
                                }),
                            ]);
                        }
                    }
                },
                CommentExit(comment) {
                    if (/#(?:ifn?def|endif)/.test(comment.text)) {
                        comment.raws.left = ' ';
                        comment.raws.right = ' ';
                    }
                },
            };
        },
    };
};
creator.postcss = true;

module.exports = creator;
