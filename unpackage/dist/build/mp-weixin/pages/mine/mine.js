"use strict";const e=require("../../common/vendor.js"),a=require("../../utils/require.js"),o=require("../../utils/eventBus.js");require("../../config.js"),Math||t();const t=()=>"../../components/LoginPopup.js",n={__name:"mine",setup(t){const n=e.ref(null),r=e.ref("device"),i=e.ref({nickname:"",avatarUrl:"",bio:"",following:0,followers:0,points:0}),s=e.ref([]),l=e.ref(0),c=e=>{l.value=e.detail.current};e.onMounted((()=>{const a=e.index.getStorageSync("userInfo");if(a)try{i.value=JSON.parse(a)}catch(t){console.error("解析本地用户信息失败:",t)}u((()=>{d(),v()})),o.emitter.on("updateUserInfo",(()=>{console.log("收到更新事件"),d(),v()}))})),e.onShow((()=>{const a=e.index.getStorageSync("userInfo");if(a)try{i.value=JSON.parse(a)}catch(o){console.error("解析本地用户信息失败:",o)}u((()=>{d(),v()}))}));const u=a=>{if(!e.index.getStorageSync("token"))return g(),!1;a()},d=async()=>{try{const o=await a.request({url:"/users/me"});200===o.data.code&&(i.value=o.data.data,e.index.setStorageSync("userInfo",JSON.stringify(o.data.data)))}catch(o){console.error("获取用户信息失败:",o),e.index.showToast({title:"获取用户信息失败",icon:"none"})}},v=async()=>{const o=JSON.parse(e.index.getStorageSync("userInfo")).openid;try{const e=await a.request({url:"/devices/user/"+o});200===e.data.code&&(s.value=e.data.data)}catch(t){console.error("获取设备列表失败:",t),e.index.showToast({title:"获取设备列表失败",icon:"none"})}},g=()=>{n.value.open()},f=e=>{console.log(e)},p=()=>{},m=e=>{r.value=e},S=()=>{e.index.navigateTo({url:"/pages/setting/setting"})},x=()=>{e.index.navigateTo({url:"/pages/points/points"})},y=()=>{e.index.navigateTo({url:"/pages/contactCostumer/contactCostumer"})},h=()=>{e.index.navigateTo({url:"/pages/message/message"})};return(a,o)=>e.e({a:i.value.avatarUrl||"/static/avatar.jpg",b:e.t(i.value.nickname||"未设置昵称"),c:e.t(i.value.bio||""),d:e.t(i.value.following||0),e:e.t(i.value.followers||0),f:e.t(i.value.points||0),g:e.o(x),h:"device"===r.value},(r.value,{}),{i:"device"===r.value?1:"",j:e.o((e=>m("device"))),k:"medal"===r.value},(r.value,{}),{l:"medal"===r.value?1:"",m:e.o((e=>m("medal"))),n:"device"===r.value},"device"===r.value?{o:e.f(s.value,((a,o,t)=>({a:e.t(a.device_name),b:"online"===a.device_status?1:"",c:e.t("online"===a.device_status?"已连接":"未连接"),d:o}))),p:e.o((o=>(a.device,void e.index.navigateTo({url:"/pages/device/device"})))),q:e.o(((...e)=>a.handleAddDevice&&a.handleAddDevice(...e))),r:l.value,s:e.o(c)}:{},{t:"medal"===r.value},(r.value,{}),{v:e.o(S),w:e.o(h),x:e.o(y),y:e.sr(n,"093d7f73-0",{k:"loginPopupRef"}),z:e.o(f),A:e.o(p)})}};wx.createPage(n);
