"use strict";const a=require("../../common/vendor.js"),e=require("../../utils/require.js");if(require("../../config.js"),!Array){a.resolveComponent("uni-popup")()}Math;const t={__name:"ranking",setup(t){const r=a.ref("national"),n=a.ref("杭州");a.ref("浙江省");const l=a.ref("day"),i=a.ref([]),o=a.ref(null),u=a.ref([]),c=a.ref(null),d=a.ref([]);a.ref(0),a.ref(null);const s=a.ref(!1),v=a.ref(""),y=a.computed((()=>u.value&&Array.isArray(u.value)?u.value:[])),f=()=>{c.value.close(),s.value=!1},m=async()=>{await e.request({url:"/rankings/generate-mock-data",method:"POST"})},k=async(t="daily")=>{try{let a;if(a="national"===r.value?await e.request({url:"/rankings",data:{type:t,limit:20}}):await e.request({url:"/rankings/region",data:{type:t,city:n.value,cityCode:v.value}}),200===a.data.code){const e=a.data.data;u.value=e.slice(0,3).map((a=>({name:a.user_id.nickname,avatar:a.user_id.avatarUrl,score:((a.total_distance||0)/1e3).toFixed(2),rank:a.rank}))),i.value=e.slice(3).map((a=>({name:a.user_id.nickname,avatar:a.user_id.avatarUrl,distance:((a.total_distance||0)/1e3).toFixed(2),rank:a.rank})))}}catch(l){console.error("获取排行榜失败:",l),a.index.showToast({title:"获取排行榜失败",icon:"none"})}},p=async()=>{var a,t;try{const r=await e.request({url:"/rankings/me",data:{type:"day"===l.value?"daily":"month"===l.value?"monthly":"yearly"}});if(200===r.data.code){const e=r.data.data;o.value=e?{rank:e.rank||0,name:(null==(a=e.user_id)?void 0:a.nickname)||"未知用户",avatar:(null==(t=e.user_id)?void 0:t.avatarUrl)||"/static/default-avatar.png",distance:((e.total_distance||0)/1e3).toFixed(2)}:{rank:0,name:"未知用户",avatar:"/static/default-avatar.png",distance:0}}}catch(r){console.error("获取个人排名失败:",r),o.value={rank:0,name:"未知用户",avatar:"/static/default-avatar.png",distance:0}}},g=async a=>{l.value=a;await k({day:"daily",month:"monthly",year:"yearly"}[a]),await p()};return a.onMounted((()=>{k(),p()})),a.onShow((()=>{k(),p()})),(e,t)=>a.e({a:a.o(m),b:a.o(f),c:a.f(d.value,((e,t,r)=>({a:a.t(e.city),b:a.t(e.userCount),c:e.cityCode,d:a.o((a=>{return t=e,n.value=t.city,v.value=t.cityCode,f(),void k(l.value);var t}),e.cityCode)}))),d:a.sr(c,"25b49241-0",{k:"cityPopup"}),e:a.p({type:"center","background-color":"#fff"}),f:"day"===l.value?1:"",g:a.o((a=>g("day"))),h:"month"===l.value?1:"",i:a.o((a=>g("month"))),j:"year"===l.value?1:"",k:a.o((a=>g("year"))),l:a.f(y.value,((e,t,r)=>a.e({a:e},e?{b:e.avatar||"/static/avatar-default@3x.png",c:a.t(e.rank),d:a.t(e.name),e:a.t(e.score),f:a.n(1===e.rank?"yellow":2===e.rank?"orange":"pink")}:{g:e.avatar||"/static/avatar-default@3x.png",h:a.t(0===t?2:1===t?1:3),i:a.n(0===t?"orange":1===t?"yellow":"pink")},{j:t}))),m:i.value.length>0},i.value.length>0?{n:a.f(i.value,((e,t,r)=>({a:a.t(e.rank),b:e.avatar||"/static/avatar-default@3x.png",c:a.t(e.name),d:a.t(e.distance),e:e.rank})))}:{},{o:a.t(o.value.rank),p:o.value.avatar||"/static/avatar-default@3x.png",q:a.t(o.value.name),r:a.t(o.value.distance)})}};wx.createPage(t);
