"use strict";const e=require("../../common/vendor.js"),l=require("../../utils/require.js"),o=require("../../api/userRelations.js"),a=require("../../utils/eventBus.js");require("../../config.js");const i={__name:"followingList",setup(i){const u=e.ref("following"),n=e.ref(""),r=e.ref([]),t=e.ref(1),s=e.ref(20),v=e.ref(!1),f=e.ref(!1),g=e.ref(!0),c=e.computed((()=>n.value?r.value.filter((e=>e.nickname.toLowerCase().includes(n.value.toLowerCase()))):r.value)),w=e=>{u.value=e,t.value=1,r.value=[],d()},d=async()=>{if(console.log(u.value),!(v.value||!g.value&&t.value>1)){v.value=!0;try{const e=`/user-relations/${u.value}`,o=await l.request({url:e,data:{page:t.value,pageSize:s.value}});if(200===o.statusCode){const e=o.data.data.map((e=>{const l="following"===u.value?e.toUser:e.fromUser;return{id:l._id,nickname:l.nickname,avatarUrl:l.avatarUrl,bio:l.bio,isFollowing:!0}}));1===t.value?r.value=e:r.value=[...r.value,...e],g.value=e.length===s.value,t.value+=1}}catch(o){console.error("获取用户列表失败:",o),e.index.showToast({title:"获取列表失败",icon:"none"})}finally{v.value=!1,f.value=!1}}},h=()=>{f.value=!0,t.value=1,g.value=!0,d()},m=()=>{g.value&&d()};return e.onMounted((()=>{d(),a.emitter.on("updateFollowingList",(()=>{console.log("收到更新事件"),d()}))})),(l,a)=>e.e({a:"following"===u.value},(u.value,{}),{b:"following"===u.value?1:"",c:e.o((e=>w("following"))),d:"followers"===u.value},(u.value,{}),{e:"followers"===u.value?1:"",f:e.o((e=>w("followers"))),g:c.value.length>0},c.value.length>0?{h:e.f(c.value,((l,a,i)=>e.e({a:l.avatarUrl||"/static/avatar.png",b:e.t(l.nickname||"未设置昵称"),c:e.o((o=>{return a=l.id,void e.index.navigateTo({url:`/pages/userProfile/userProfile?id=${a}`});var a}),a)},"following"===u.value?{d:e.t(l.isFollowing?"已关注":"关注"),e:e.n(l.isFollowing?"following":""),f:l.isFollowing?1:"",g:e.o((a=>(async l=>{try{l.isFollowing?(await o.userRelationsApi.unfollowUser(l.id),l.isFollowing=!1,"following"===u.value&&(r.value=r.value.filter((e=>e.id!==l.id)))):(await o.userRelationsApi.followUser(l.id),l.isFollowing=!0),e.index.showToast({title:l.isFollowing?"关注成功":"取消关注成功",icon:"success"})}catch(a){console.error("操作失败:",a),e.index.showToast({title:"操作失败",icon:"none"})}})(l)),a)}:{},{h:a}))),i:"following"===u.value}:{j:e.t("following"===u.value?"还没有关注任何人":"还没有粉丝")},{k:v.value&&c.value.length>0},(v.value&&c.value.length,{}),{l:e.o(m),m:f.value,n:e.o(h)})}};wx.createPage(i);
