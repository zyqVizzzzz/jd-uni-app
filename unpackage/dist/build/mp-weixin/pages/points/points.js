"use strict";const e=require("../../common/vendor.js"),t=require("../../api/points.js");require("../../utils/require.js"),require("../../config.js");const a={__name:"points",setup(a){const i=e.ref(0),s=e.ref([{id:1,name:"游泳距离达到500米",points:50,completed:!0,icon:"/static/icons/points-swim-500.png",iconClass:"blue"},{id:2,name:"游泳距离达到1000米",points:100,completed:!1,icon:"/static/icons/points-swim-1000.png",iconClass:"yellow"},{id:3,name:"发布动态",points:20,completed:!1,icon:"/static/icons/points-post.png",iconClass:"pink"},{id:4,name:"分享游泳数据",points:30,completed:!1,icon:"/static/icons/points-share.png",iconClass:"purple"}]),n=e.ref([{id:1,name:"焦动XXXXXX",points:5e3,image:"/static/avatar.jpg"},{id:2,name:"焦动XXXXXX",points:2e3,image:"/static/avatar2.jpg"}]);e.onMounted((()=>{(async()=>{try{const e=await t.pointApi.getDailyTasks();200===e.data.code&&(s.value=s.value.map((t=>{const a=e.data.data.find((e=>{switch(t.id){case 1:return"SWIM_500M"===e.type;case 2:return"SWIM_1000M"===e.type;case 3:return"POST_STATUS"===e.type;case 4:return"SHARE_DATA"===e.type;default:return!1}}));return{...t,completed:!!a&&a.completed}})))}catch(a){e.index.showToast({title:"获取任务状态失败",icon:"none"})}})(),(async()=>{try{const e=await t.pointApi.getUserPoints();200===e.data.code&&(i.value=e.data.data.totalPoints)}catch(e){}})()}));const o=()=>{e.index.navigateTo({url:"/pages/points/details?points="+i.value})};return(t,a)=>({a:e.o(o),b:e.t(i.value),c:e.f(s.value,((t,a,i)=>({a:t.icon,b:e.n(t.iconClass),c:e.t(t.name),d:e.t(t.points),e:e.t(t.completed?"已完成":"去完成"),f:t.completed?1:"",g:e.o((a=>(async t=>{if(!t.completed)switch(t.id){case 1:case 2:e.index.navigateTo({url:"/pages/swimming/index"});break;case 3:e.index.navigateTo({url:"/pages/post/create"});break;case 4:e.index.navigateTo({url:"/pages/share/index"})}})(t)),t.id),h:t.id}))),d:e.f(n.value,((t,a,s)=>({a:t.image,b:e.t(t.name),c:e.t(t.points),d:e.t(i.value>=t.points?"立即兑换":"积分不足"),e:i.value<t.points?1:"",f:e.o((a=>(async t=>{if(i.value<t.points)e.index.showToast({title:"积分不足",icon:"none"});else try{200===(await request({url:"/points/exchange",method:"POST",data:{itemId:t.id}})).statusCode&&(e.index.showToast({title:"兑换成功",icon:"success"}),i.value-=t.points)}catch(a){e.index.showToast({title:"兑换失败",icon:"error"})}})(t)),t.id),g:t.id})))})}},i=e._export_sfc(a,[["__scopeId","data-v-99973e7e"]]);wx.createPage(i);
